name: Test Max Parallel

on:
  workflow_dispatch:

jobs:
  test:
    # Unique label per matrix job ensures 1:1 binding with runner
    # run_id is unique per workflow run, job-index is unique per matrix entry
    runs-on: [self-hosted, modal, "job-${{ github.run_id }}-${{ strategy.job-index }}"]
    strategy:
      max-parallel: 5
      matrix:
        job: [1, 2, 3, 4, 5]
    steps:
      - run: |
          echo "=== Job ${{ matrix.job }} starting at $(date) ==="
          sleep 30
          echo "=== Job ${{ matrix.job }} done at $(date) ==="
